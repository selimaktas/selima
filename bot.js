const Discord = require('discord.js');
const client = new Discord.Client();
const ayarlar = require('./ayarlar.json');
const chalk = require('chalk');
const fs = require('fs');
const moment = require('moment');
require('./util/eventLoader')(client);

var prefix = ayarlar.prefix;

const log = message => {
  console.log(`[${moment().format('YYYY-MM-DD HH:mm:ss')}] ${message}`);
};


client.reload = command => {
  return new Promise((resolve, reject) => {
    try {
      delete require.cache[require.resolve(`./komutlar/${command}`)];
      let cmd = require(`./komutlar/${command}`);
      client.commands.delete(command);
      client.aliases.forEach((cmd, alias) => {
        if (cmd === command) client.aliases.delete(alias);
      });
      client.commands.set(command, cmd);
      cmd.conf.aliases.forEach(alias => {
        client.aliases.set(alias, cmd.help.name);
      });
      resolve();
    } catch (e){
      reject(e);
    }
  });
};

client.commands = new Discord.Collection();
client.aliases = new Discord.Collection();
fs.readdir('./komutlar/', (err, files) => {
  if (err) console.error(err);
  log(`${files.length} komut y√ºklenecek.`);
  files.forEach(f => {
    let props = require(`./komutlar/${f}`);
    log(`Y√ºklenen komut: ${props.help.name}.`);
    client.commands.set(props.help.name, props);
    props.conf.aliases.forEach(alias => {
      client.aliases.set(alias, props.help.name);
    });
  });
});


client.load = command => {
  return new Promise((resolve, reject) => {
    try {
      let cmd = require(`./komutlar/${command}`);
      client.commands.set(command, cmd);
      cmd.conf.aliases.forEach(alias => {
        client.aliases.set(alias, cmd.help.name);
      });
      resolve();
    } catch (e){
      reject(e);
    }
  });
};

client.unload = command => {
  return new Promise((resolve, reject) => {
    try {
      delete require.cache[require.resolve(`./komutlar/${command}`)];
      let cmd = require(`./komutlar/${command}`);
      client.commands.delete(command);
      client.aliases.forEach((cmd, alias) => {
        if (cmd === command) client.aliases.delete(alias);
      });
      resolve();
    } catch (e){
      reject(e);
    }
  });
};
////////////////////////////////////


client.on('message', async message => {
  const ms = require('ms');
  const args = message.content.slice(ayarlar.prefix.length).trim().split(/ +/g);
  const command = args.shift().toLowerCase();
  let u = message.mentions.users.first() || message.author;
  if (command === "sunucu-kur") {
  if (message.guild.channels.find(channel => channel.name === "Bot Kullanƒ±mƒ±")) return message.channel.send(" Bot Paneli Zaten Ayarlanmƒ±≈ü.")
  if (!message.member.hasPermission('ADMINISTRATOR'))
  return message.channel.send(" Bu Kodu `Y√∂netici` Yetkisi Olan Ki≈üi Kullanabilir.");
    message.channel.send(`Bot Bilgi Kanallarƒ±nƒ±n kurulumu ba≈ülatƒ±lsƒ±n mƒ±? ba≈ülatƒ±lacak ise **evet** yazƒ±nƒ±z.`)
      message.channel.awaitMessages(response => response.content === 'evet', {
        max: 1,
        time: 10000,
        errors: ['time'],
      })
    .then((collected) => {
   message.guild.createChannel('|‚ñ¨‚ñ¨|√ñNEMLƒ∞ KANALLAR|‚ñ¨‚ñ¨|', 'category', [{
  id: message.guild.id,
  deny: ['SEND_MESSAGES']
}])



        
 message.guild.createChannel('„ÄåüìÉ„Äçkurallar', 'text', [{
  id: message.guild.id,
  deny: ['SEND_MESSAGES']
}])
.then(channel =>
 channel.setParent(message.guild.channels.find(channel => channel.name === "|‚ñ¨‚ñ¨|√ñNEMLƒ∞ KANALLAR|‚ñ¨‚ñ¨|")));
 message.guild.createChannel('„Äåüö™„Äçgelen-giden', 'text', [{
  id: message.guild.id,
  deny: ['SEND_MESSAGES']
}])
.then(channel =>
       channel.setParent(message.guild.channels.find(channel => channel.name === "|‚ñ¨‚ñ¨|√ñNEMLƒ∞ KANALLAR|‚ñ¨‚ñ¨|")));
       message.guild.createChannel('„Äå‚úÖ„Äçsaya√ß', 'text', [{
        id: message.guild.id,
        deny: ['SEND_MESSAGES']
      }])
.then(channel =>
             channel.setParent(message.guild.channels.find(channel => channel.name === "|‚ñ¨‚ñ¨|√ñNEMLƒ∞ KANALLAR|‚ñ¨‚ñ¨|")));
             message.guild.createChannel('„Äåüíæ„Äçlog-kanalƒ±', 'text', [{
              id: message.guild.id,
              deny: ['SEND_MESSAGES']
            }])
            .then(channel => channel.setParent(message.guild.channels.find(channel => channel.name === "|‚ñ¨‚ñ¨|√ñNEMLƒ∞ KANALLAR|‚ñ¨‚ñ¨|")));
            message.guild.createChannel('„Äåüì¢„Äçduyuru-odasƒ±', 'text', [{
              id: message.guild.id,
              deny: ['SEND_MESSAGES']
            }])
.then(channel =>
 channel.setParent(message.guild.channels.find(channel => channel.name === "|‚ñ¨‚ñ¨|√ñNEMLƒ∞ KANALLAR|‚ñ¨‚ñ¨|")));

       }) 
       .then((collected) => {
        message.guild.createChannel('|‚ñ¨‚ñ¨|GENEL KANALLAR|‚ñ¨‚ñ¨|', 'category', [{
       id: message.guild.id,
     }]);
             
      message.guild.createChannel(`„Äåüí°„Äç≈üikayet-ve-√∂neri`, 'text')
     .then(channel =>
      channel.setParent(message.guild.channels.find(channel => channel.name === "|‚ñ¨‚ñ¨|GENEL KANALLAR|‚ñ¨‚ñ¨|")));
     message.guild.createChannel(`„Äåüë•„Äçpre-arama-odasƒ±`, 'text')
     .then(channel =>
            channel.setParent(message.guild.channels.find(channel => channel.name === "|‚ñ¨‚ñ¨|GENEL KANALLAR|‚ñ¨‚ñ¨|")));
     message.guild.createChannel(`„Äåüì∑„Äçg√∂rsel-i√ßerik`, 'text')
     .then(channel =>
                  channel.setParent(message.guild.channels.find(channel => channel.name === "|‚ñ¨‚ñ¨|GENEL KANALLAR|‚ñ¨‚ñ¨|")));
     message.guild.createChannel(`„Äåü§ñ„Äçbot-komutlarƒ±`, 'text')
     .then(channel =>
                  channel.setParent(message.guild.channels.find(channel => channel.name === "|‚ñ¨‚ñ¨|GENEL KANALLAR|‚ñ¨‚ñ¨|")));
     message.guild.createChannel(`„Äåüí¨„Äçsohbet`, 'text')
     .then(channel =>
      channel.setParent(message.guild.channels.find(channel => channel.name === "|‚ñ¨‚ñ¨|GENEL KANALLAR|‚ñ¨‚ñ¨|")));

      message.guild.createChannel(`üèÜ„ÄãKurucu Odasƒ±`, "voice")
      .then(channel =>
        channel.setParent(message.guild.channels.find(channel => channel.name === "|‚ñ¨‚ñ¨|SES KANALLARI|‚ñ¨‚ñ¨|")))
      .then(c => {
        let role = message.guild.roles.find("name", "@everyone");
        let role2 = message.guild.roles.find("name", "Kurucu");
        
        c.overwritePermissions(role, {
            CONNECT: false,
        });
        c.overwritePermissions(role2, {
            CONNECT: true,
            
        });
    })

    message.guild.createChannel('|‚ñ¨‚ñ¨|SES KANALLARI|‚ñ¨‚ñ¨|', 'category', [{
      id: message.guild.id,
    }]);

    message.guild.createChannel(`üèÜ„ÄãY√∂netici Odasƒ±`, "voice")
    .then(channel =>
      channel.setParent(message.guild.channels.find(channel => channel.name === "|‚ñ¨‚ñ¨|SES KANALLARI|‚ñ¨‚ñ¨|")))
    .then(c => {
      let role = message.guild.roles.find("name", "@everyone");
      let role2 = message.guild.roles.find("name", "Kurucu");
      let role3 = message.guild.roles.find("name", "Y√∂netici");
      c.overwritePermissions(role, {
          CONNECT: false,
      });
      c.overwritePermissions(role2, {
          CONNECT: true,
      });
      c.overwritePermissions(role3, {
          CONNECT: true,
      });
  })

  message.guild.createChannel(`üí¨„ÄãSohbet Odasƒ±`, "voice")
  .then(channel =>
    channel.setParent(message.guild.channels.find(channel => channel.name === "|‚ñ¨‚ñ¨|SES KANALLARI|‚ñ¨‚ñ¨|")))
  .then(c => {
    let role = message.guild.roles.find("name", "@everyone");
    c.overwritePermissions(role, {
        CONNECT: true,
    });
})

message.guild.createChannel('|‚ñ¨‚ñ¨|OYUN ODALARI|‚ñ¨‚ñ¨|', 'category', [{
  id: message.guild.id,
}]);

message.guild.createChannel(`üéÆ„ÄãLOL`, 'voice')
.then(channel =>
 channel.setParent(message.guild.channels.find(channel => channel.name === "|‚ñ¨‚ñ¨|OYUN ODALARI|‚ñ¨‚ñ¨|")))
 message.guild.createChannel(`üéÆ„ÄãZULA`, 'voice')
 .then(channel =>
  channel.setParent(message.guild.channels.find(channel => channel.name === "|‚ñ¨‚ñ¨|OYUN ODALARI|‚ñ¨‚ñ¨|")))
 message.guild.createChannel(`üéÆ„ÄãCOUNTER STRƒ∞KE`, 'voice')
.then(channel =>
 channel.setParent(message.guild.channels.find(channel => channel.name === "|‚ñ¨‚ñ¨|OYUN ODALARI|‚ñ¨‚ñ¨|")))
 message.guild.createChannel(`üéÆ„ÄãPUBG`, 'voice')
 .then(channel =>
  channel.setParent(message.guild.channels.find(channel => channel.name === "|‚ñ¨‚ñ¨|OYUN ODALARI|‚ñ¨‚ñ¨|")))
  message.guild.createChannel(`üéÆ„ÄãFORTNƒ∞TE`, 'voice')
  .then(channel =>
   channel.setParent(message.guild.channels.find(channel => channel.name === "|‚ñ¨‚ñ¨|OYUN ODALARI|‚ñ¨‚ñ¨|")))
   message.guild.createChannel(`üéÆ„ÄãMƒ∞NECRAFT`, 'voice')
   .then(channel =>
    channel.setParent(message.guild.channels.find(channel => channel.name === "|‚ñ¨‚ñ¨|OYUN ODALARI|‚ñ¨‚ñ¨|")))
    message.guild.createChannel(`üéÆ„ÄãROBLOX`, 'voice')
    .then(channel =>
     channel.setParent(message.guild.channels.find(channel => channel.name === "|‚ñ¨‚ñ¨|OYUN ODALARI|‚ñ¨‚ñ¨|")))
     message.guild.createChannel(`üéÆ„ÄãWOLFTEAM`, 'voice')
     .then(channel =>
      channel.setParent(message.guild.channels.find(channel => channel.name === "|‚ñ¨‚ñ¨|OYUN ODALARI|‚ñ¨‚ñ¨|")))



      message.guild.createRole({
        name: 'Kurucu',
        color: 'RED',
        permissions: [
            "ADMINISTRATOR",
    ]
      })

      
      message.guild.createRole({
        name: 'Y√∂netici',
        color: 'BLUE',
        permissions: [
            "MANAGE_GUILD",
            "MANAGE_ROLES",
            "MUTE_MEMBERS",
            "DEAFEN_MEMBERS",
            "MANAGE_MESSAGES",
            "MANAGE_NICKNAMES",
            "KICK_MEMBERS"
    ]
      })

      message.guild.createRole({
        name: 'Moderat√∂r',
        color: 'GREEN',
        permissions: [
            "MANAGE_GUILD",
            "MANAGE_ROLES",
            "MUTE_MEMBERS",
            "DEAFEN_MEMBERS",
            "MANAGE_MESSAGES",
            "MANAGE_NICKNAMES"
    ]
      })

      message.guild.createRole({
        name: 'V.I.P',
        color: '00ffff',
      })

      message.guild.createRole({
        name: '√úye',
        color: 'WHITE',
      })

      message.guild.createRole({
        name: 'Bot',
        color: 'ORANGE',
      })

       message.channel.send("Gerekli Odalar Kuruldu!")
     
            })   
    
}
});

client.on('message', msg => {
  if (msg.content.toLowerCase() === 'sil500') {
    if (msg.channel.type === 'dm') {
      const ozelmesajuyari = new Discord.RichEmbed()
    .setColor(0xdcff00)
    .setTimestamp()
    .setAuthor(msg.author.username, msg.author.avatarURL)
    .addField('‚ö† Uyarƒ± ‚ö†', 'Bu komutu √∂zel mesajlarda kullanamazsƒ±n.')
    msg.author.sendEmbed(ozelmesajuyari); }
      if (msg.channel.type !== 'dm') {
        if (!msg.member.hasPermission("MANAGE_MESSAGES")) {
          if (msg.author.id !== ayarlar.yapimci) {
            const mesajlariyonet = new Discord.RichEmbed()
          .setColor(0xFF0000)
          .setTimestamp()
          .setAuthor(msg.author.username, msg.author.avatarURL)
          .addField('‚ö† Uyarƒ± ‚ö†', 'Bu komutu kulllanmak i√ßin `Mesajlarƒ± Y√∂net` iznine sahip olmalƒ±sƒ±n.')
          return msg.author.sendEmbed(mesajlariyonet);
      }}
      msg.channel.bulkDelete(100);
      msg.channel.bulkDelete(100);
      msg.channel.bulkDelete(100);
      msg.channel.bulkDelete(100);
      msg.channel.bulkDelete(100);

      const sohbetsilindi = new Discord.RichEmbed()
    .setColor(0x35ff00)
    .setTimestamp()
    .addField('Eylem:', '**Sohbet silme**')
    .addField('Yetkili:', '` ' + msg.author.username + '`')
    .addField('Silinen Mesaj Sayƒ±sƒ±:', '¬ª'+ '  **500**  ' + '¬´')
    .addField('Sonu√ß:', '`Ba≈üarƒ±lƒ±`'+ ' ‚úÖ ')
    return msg.channel.sendEmbed(sohbetsilindi).then(msg => msg.delete(2900));
}}});
////////////////////////

//////////////////////

client.on("message", msg => {
  const uyarƒ±embed = new Discord.RichEmbed()
    .setColor(0x00AE86)
    .setDescription(":crown: " + msg.author + "Reklam Yapmayƒ± Kes Seni Yetkililere S√∂yledim :angry: :rage: ")

const dmembed = new Discord.RichEmbed()
  .setTitle("Sunucunda " + msg.author.tag + " reklam yapƒ±yor!")
    .setColor(0x00AE86)
    .setDescription(" " + msg.author.tag + " Sunucunda Reklam Yapƒ±yor -ban Komutu ƒ∞le Ki≈üiyi Banlayabilirsin ")
  .addField("Kullanƒ±cƒ±nƒ±n mesajƒ±:", "**" + msg.content + "**")

if (msg.content.toLowerCase().match(/(discord\.gg\/)|(discordapp\.com\/invite\/)/g) && msg.channel.type === "text" && msg.channel.permissionsFor(msg.guild.member(client.user)).has("MANAGE_MESSAGES")) {
  if(msg.member.hasPermission('BAN_MEMBERS')){
  return;
  } else {
  msg.delete(30).then(deletedMsg => {
   deletedMsg.channel.send(uyarƒ±embed)
   msg.guild.owner.send(dmembed).catch(e => {
          console.error(e);
        });
      }).catch(e => {
        console.error(e);
      });
    };
    };
  })


//////////////////////
////////////
client.on('message', msg => {
  if (msg.content.toLowerCase() === 'sa') {
      msg.reply('Aleyk√ºm Selam Ho≈ügeldin !');
}
});
client.on('message', msg => {
  if (msg.content.toLowerCase() === 's.a') {
      msg.reply('Aleyk√ºm Selam Ho≈ügeldin !');
}
});
client.on('message', async msg => {
  if (msg.content.toLowerCase() === 'sa') {
    await msg.react('üá¶');
    msg.react('üá∏');
  }
  });
client.on('message', async msg => {
  if (msg.content.toLowerCase() === 's.a') {
    await msg.react('üá¶');
    msg.react('üá∏');
  }
  });

///////K√úF√úRLER/////



client.on('message', msg => {
  if (msg.content === '<@546303073962950657>') {
   msg.delete(30)
    msg.reply('`Sahibimi etiketlemen yasak bilmiyormusun ?  - Ban y√ºkleniyor...`');
  }
});



///////K√úF√úRLER/////






////////////////////////


////////////////////////








client.elevation = message => {
  if(!message.guild) {
	return; }
  let permlvl = 0;
  if (message.member.hasPermission("BAN_MEMBERS")) permlvl = 2;
  if (message.member.hasPermission("ADMINISTRATOR")) permlvl = 3;
  if (message.author.id === ayarlar.sahip) permlvl = 4;
  return permlvl;
};

var regToken = /[\w\d]{24}\.[\w\d]{6}\.[\w\d-_]{27}/g;

client.on('warn', e => {
  console.log(chalk.bgYellow(e.replace(regToken, 'that was redacted')));
});

client.on('error', e => {
  console.log(chalk.bgRed(e.replace(regToken, 'that was redacted')));
});

///////////






client.login(ayarlar.token);
